<!DOCTYPE html>
<html lang="en">
  <head>
    


<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="">
<link rel="canonical" href="https://wukongsec.com/blog/deobfuscating-javascript-using-ast">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Exo:300,500,800|Roboto&display=swap">
<link rel="stylesheet" href="https://wukongsec.com/assets/main.css" />
<link rel="icon" type="image/png" href="https://wukongsec.com/favicon.png">
<title>WuKong Securityä¸¨æ‚Ÿç©ºä¿¡æ¯å®‰å…¨ - åˆ©ç”¨ AST è¿˜åŸ JavaScript æ··æ·†ä»£ç </title>

  </head>
  <body>
    <header id="menu">
  <div class="header-wrapper">
    <nav class="main-nav">
      <a href="https://wukongsec.com" class="logo-link">
        <img width="206" alt="PM2 logo" src="https://wukongsec.com/assets/img/logo/logo_wk_003.png" />
      </a>
      <div class="menu">
        <a href="#menu" class="button accent-border border-corners inner-shadows menu-button">
          <div class="menu-icon"></div>
        </a>
        <a href="#" class="menu-overlay"></a>
        <div class="menu-content">
          <div class="doc-links">
            <a href="https://wukongsec.com">é¦–é¡µ Index</a>
            <a href="https://bbs.wukongsec.com/" target="_blank">è®ºå› BBS</a>
            <a href="https://wukongsec.com/blog" class="">åšå®¢ Blog</a>
          </div>
          <a href="https://wukongsec.com/contact" title="Get started" class="button accent-border border-corners inner-shadows">
            è”ç³»æˆ‘ä»¬ Contact
          </a>
        </div>
      </div>
    </nav>
  </div>
</header>

    <main class="post">
      <section class="section-hero">
        <div class="section-background">
          <div class="hexagon hexagon-1"></div>
<!--          <div class="hexagon hexagon-2"></div>-->
          <div class="hexagon hexagon-3"></div>
          <div class="hexagon hexagon-4"></div>
        </div>
        <div class="section-wrapper">
          <h1>åˆ©ç”¨ AST è¿˜åŸ JavaScript æ··æ·†ä»£ç </h1>
        </div>
      </section>
      <section>
        <div class="section-background">
          <div class="hexagon hexagon-5"></div>
        </div>
        <div class="section-wrapper">
          <div class="content">
            <div class="container">
              <h1 class="align-center">åˆ©ç”¨ AST è¿˜åŸ JavaScript æ··æ·†ä»£ç </h1>
              
                <p class="align-center">
                  
                    
                      ä½œè€…ï¼š<a href="https://www.itbob.cn/about/" target="_blank">ç«™é•¿ BOB</a>
                    ä¸¨
                  
                  
                    åŸå§‹é“¾æ¥ï¼š<a href="https://www.itbob.cn/article/051/" target="_blank">https://www.itbob.cn/article/051/</a> ä¸¨
                  
                  å‘å¸ƒæ—¶é—´ï¼š2022-04-25 09:00:00 +0000
                </p>
              
            </div>
            <hr>
            <p><img src="https://static.spiderapi.cn/itbob/images/cover/ast.png" alt="ast" /></p>

<h2 id="ä»€ä¹ˆæ˜¯-ast">ä»€ä¹ˆæ˜¯ AST</h2>

<p>ASTï¼ˆAbstract Syntax Treeï¼‰ï¼Œä¸­æ–‡æŠ½è±¡è¯­æ³•æ ‘ï¼Œç®€ç§°è¯­æ³•æ ‘ï¼ˆSyntax Treeï¼‰ï¼Œæ˜¯æºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç°å½¢å¼ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚è¯­æ³•æ ‘ä¸æ˜¯æŸä¸€ç§ç¼–ç¨‹è¯­è¨€ç‹¬æœ‰çš„ï¼ŒJavaScriptã€Pythonã€Javaã€Golang ç­‰å‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¯­æ³•æ ‘ã€‚</p>

<p>å°æ—¶å€™æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªç©å…·ï¼Œæ€»å–œæ¬¢æŠŠç©å…·æ‹†è§£æˆä¸€ä¸ªä¸€ä¸ªå°é›¶ä»¶ï¼Œç„¶åæŒ‰ç…§æˆ‘ä»¬è‡ªå·±çš„æƒ³æ³•ï¼ŒæŠŠé›¶ä»¶é‡æ–°ç»„è£…èµ·æ¥ï¼Œä¸€ä¸ªæ–°ç©å…·å°±è¯ç”Ÿäº†ã€‚è€Œ JavaScript å°±åƒä¸€å°ç²¾å¦™è¿ä½œçš„æœºå™¨ï¼Œé€šè¿‡ AST è§£æï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒç«¥å¹´æ—¶æ‹†è§£ç©å…·ä¸€æ ·ï¼Œæ·±å…¥äº†è§£ JavaScript è¿™å°æœºå™¨çš„å„ä¸ªé›¶éƒ¨ä»¶ï¼Œç„¶åé‡æ–°æŒ‰ç…§æˆ‘ä»¬è‡ªå·±çš„æ„æ„¿æ¥ç»„è£…ã€‚</p>

<p>AST çš„ç”¨é€”å¾ˆå¹¿ï¼ŒIDE çš„è¯­æ³•é«˜äº®ã€ä»£ç æ£€æŸ¥ã€æ ¼å¼åŒ–ã€å‹ç¼©ã€è½¬è¯‘ç­‰ï¼Œéƒ½éœ€è¦å…ˆå°†ä»£ç è½¬åŒ–æˆ AST å†è¿›è¡Œåç»­çš„æ“ä½œï¼ŒES5 å’Œ ES6 è¯­æ³•å·®å¼‚ï¼Œä¸ºäº†å‘åå…¼å®¹ï¼Œåœ¨å®é™…åº”ç”¨ä¸­éœ€è¦è¿›è¡Œè¯­æ³•çš„è½¬æ¢ï¼Œä¹Ÿä¼šç”¨åˆ° ASTã€‚AST å¹¶ä¸æ˜¯ä¸ºäº†é€†å‘è€Œç”Ÿï¼Œä½†åšé€†å‘å­¦ä¼šäº† ASTï¼Œåœ¨è§£æ··æ·†æ—¶å¯ä»¥å¦‚é±¼å¾—æ°´ã€‚</p>

<p>AST æœ‰ä¸€ä¸ªåœ¨çº¿è§£æç½‘ç«™ï¼š<a href="https://astexplorer.net/">https://astexplorer.net/</a> ï¼Œé¡¶éƒ¨å¯ä»¥é€‰æ‹©è¯­è¨€ã€ç¼–è¯‘å™¨ã€æ˜¯å¦å¼€å¯è½¬åŒ–ç­‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒºåŸŸâ‘ æ˜¯æºä»£ç ï¼ŒåŒºåŸŸâ‘¡æ˜¯å¯¹åº”çš„ AST è¯­æ³•æ ‘ï¼ŒåŒºåŸŸâ‘¢æ˜¯è½¬æ¢ä»£ç ï¼Œå¯ä»¥å¯¹è¯­æ³•æ ‘è¿›è¡Œå„ç§æ“ä½œï¼ŒåŒºåŸŸâ‘£æ˜¯è½¬æ¢åç”Ÿæˆçš„æ–°ä»£ç ã€‚å›¾ä¸­åŸæ¥çš„ Unicode å­—ç¬¦ç»è¿‡æ“ä½œä¹‹åå°±å˜æˆäº†æ­£å¸¸å­—ç¬¦ã€‚</p>

<p>è¯­æ³•æ ‘æ²¡æœ‰å•ä¸€çš„æ ¼å¼ï¼Œé€‰æ‹©ä¸åŒçš„è¯­è¨€ã€ä¸åŒçš„ç¼–è¯‘å™¨ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨ JavaScript ä¸­ï¼Œç¼–è¯‘å™¨æœ‰ Acornã€Espreeã€Esprimaã€Recastã€Uglify-JS ç­‰ï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯ Babelï¼Œåç»­çš„å­¦ä¹ ä¹Ÿæ˜¯ä»¥ Babel ä¸ºä¾‹ã€‚</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/01.png" alt="01" /></p>

<h2 id="ast-åœ¨ç¼–è¯‘ä¸­çš„ä½ç½®">AST åœ¨ç¼–è¯‘ä¸­çš„ä½ç½®</h2>

<p>åœ¨ç¼–è¯‘åŸç†ä¸­ï¼Œç¼–è¯‘å™¨è½¬æ¢ä»£ç é€šå¸¸è¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼šè¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰ã€è¯­æ³•åˆ†æï¼ˆSyntax Analysisï¼‰ã€ä»£ç ç”Ÿæˆï¼ˆCode Generationï¼‰ï¼Œä¸‹å›¾ç”ŸåŠ¨å±•ç¤ºäº†è¿™ä¸€è¿‡ç¨‹ï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/02.png" alt="02" /></p>

<h3 id="è¯æ³•åˆ†æ">è¯æ³•åˆ†æ</h3>

<p>è¯æ³•åˆ†æé˜¶æ®µæ˜¯ç¼–è¯‘è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µçš„ä»»åŠ¡æ˜¯ä»å·¦åˆ°å³ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å…¥æºç¨‹åºï¼Œç„¶åæ ¹æ®æ„è¯è§„åˆ™è¯†åˆ«å•è¯ï¼Œç”Ÿæˆ token ç¬¦å·æµï¼Œæ¯”å¦‚ <code class="language-plaintext highlighter-rouge">isPanda('ğŸ¼')</code>ï¼Œä¼šè¢«æ‹†åˆ†æˆ <code class="language-plaintext highlighter-rouge">isPanda</code>ï¼Œ<code class="language-plaintext highlighter-rouge">(</code>ï¼Œ<code class="language-plaintext highlighter-rouge">'ğŸ¼'</code>ï¼Œ<code class="language-plaintext highlighter-rouge">)</code> å››éƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†éƒ½æœ‰ä¸åŒçš„å«ä¹‰ï¼Œå¯ä»¥å°†è¯æ³•åˆ†æè¿‡ç¨‹æƒ³è±¡ä¸ºä¸åŒç±»å‹æ ‡è®°çš„åˆ—è¡¨æˆ–æ•°ç»„ã€‚</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/03.gif" alt="03" /></p>

<h3 id="è¯­æ³•åˆ†æ">è¯­æ³•åˆ†æ</h3>

<p>è¯­æ³•åˆ†ææ˜¯ç¼–è¯‘è¿‡ç¨‹çš„ä¸€ä¸ªé€»è¾‘é˜¶æ®µï¼Œè¯­æ³•åˆ†æçš„ä»»åŠ¡æ˜¯åœ¨è¯æ³•åˆ†æçš„åŸºç¡€ä¸Šå°†å•è¯åºåˆ—ç»„åˆæˆå„ç±»è¯­æ³•çŸ­è¯­ï¼Œæ¯”å¦‚â€œç¨‹åºâ€ï¼Œâ€œè¯­å¥â€ï¼Œâ€œè¡¨è¾¾å¼â€ç­‰ï¼Œå‰é¢çš„ä¾‹å­ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">isPanda('ğŸ¼')</code> å°±ä¼šè¢«åˆ†æä¸ºä¸€æ¡è¡¨è¾¾è¯­å¥ <code class="language-plaintext highlighter-rouge">ExpressionStatement</code>ï¼Œ<code class="language-plaintext highlighter-rouge">isPanda()</code> å°±ä¼šè¢«åˆ†ææˆä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼ <code class="language-plaintext highlighter-rouge">CallExpression</code>ï¼Œ<code class="language-plaintext highlighter-rouge">ğŸ¼</code> å°±ä¼šè¢«åˆ†ææˆä¸€ä¸ªå˜é‡ <code class="language-plaintext highlighter-rouge">Literal</code> ç­‰ï¼Œä¼—å¤šè¯­æ³•ä¹‹é—´çš„ä¾èµ–ã€åµŒå¥—å…³ç³»ï¼Œå°±æ„æˆäº†ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œå³ AST è¯­æ³•æ ‘ã€‚</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/04.gif" alt="04" /></p>

<h3 id="ä»£ç ç”Ÿæˆ">ä»£ç ç”Ÿæˆ</h3>

<p>ä»£ç ç”Ÿæˆæ˜¯æœ€åä¸€æ­¥ï¼Œå°† AST è¯­æ³•æ ‘è½¬æ¢æˆå¯æ‰§è¡Œä»£ç å³å¯ï¼Œåœ¨è½¬æ¢ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ“ä½œè¯­æ³•æ ‘ï¼Œè¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šå˜é‡çš„å£°æ˜ä½ç½®ã€æ›´æ”¹å˜é‡çš„å€¼ã€åˆ é™¤æŸäº›èŠ‚ç‚¹ç­‰ï¼Œæˆ‘ä»¬å°†è¯­å¥ <code class="language-plaintext highlighter-rouge">isPanda('ğŸ¼')</code> ä¿®æ”¹ä¸ºä¸€ä¸ªå¸ƒå°”ç±»å‹çš„ <code class="language-plaintext highlighter-rouge">Literal</code>ï¼š<code class="language-plaintext highlighter-rouge">true</code>ï¼Œè¯­æ³•æ ‘å°±æœ‰å¦‚ä¸‹å˜åŒ–ï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/05.gif" alt="05" /></p>

<h2 id="babel-ç®€ä»‹">Babel ç®€ä»‹</h2>

<p>Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªè§£æåº“ï¼ŒBabel ä¸­æ–‡ç½‘ï¼šhttps://www.babeljs.cn/ ï¼ŒBabel è‹±æ–‡å®˜ç½‘ï¼šhttps://babeljs.io/ ï¼ŒBabel å†…ç½®äº†å¾ˆå¤šåˆ†æ JavaScript ä»£ç çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Babel å°† JavaScript ä»£ç è½¬æ¢æˆ AST è¯­æ³•æ ‘ï¼Œç„¶åå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œä¹‹åï¼Œå†è½¬æ¢æˆ JavaScript ä»£ç ã€‚</p>

<p>Babel åŒ…å«çš„å„ç§åŠŸèƒ½åŒ…ã€APIã€å„æ–¹æ³•å¯é€‰å‚æ•°ç­‰ï¼Œéƒ½éå¸¸å¤šï¼Œæœ¬æ–‡ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œåº”å½“å¤šæŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼Œæˆ–è€…å‚è€ƒæ–‡æœ«ç»™å‡ºçš„ä¸€äº›å­¦ä¹ èµ„æ–™ã€‚Babel çš„å®‰è£…å’Œå…¶ä»– Node åŒ…ä¸€æ ·ï¼Œéœ€è¦å“ªä¸ªå®‰è£…å“ªä¸ªå³å¯ï¼Œæ¯”å¦‚ <code class="language-plaintext highlighter-rouge">npm install @babel/core @babel/parser @babel/traverse @babel/generator</code></p>

<p>åœ¨åšé€†å‘è§£æ··æ·†ä¸­ï¼Œä¸»è¦ç”¨åˆ°äº† Babel çš„ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½åŒ…ï¼Œæœ¬æ–‡ä¹Ÿä»…ä»‹ç»ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½åŒ…ï¼š</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">@babel/core</code>ï¼šBabel ç¼–è¯‘å™¨æœ¬èº«ï¼Œæä¾›äº† babel çš„ç¼–è¯‘ APIï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">@babel/parser</code>ï¼šå°† JavaScript ä»£ç è§£ææˆ AST è¯­æ³•æ ‘ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">@babel/traverse</code>ï¼šéå†ã€ä¿®æ”¹ AST è¯­æ³•æ ‘çš„å„ä¸ªèŠ‚ç‚¹ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">@babel/generator</code>ï¼šå°† AST è¿˜åŸæˆ JavaScript ä»£ç ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">@babel/types</code>ï¼šåˆ¤æ–­ã€éªŒè¯èŠ‚ç‚¹çš„ç±»å‹ã€æ„å»ºæ–° AST èŠ‚ç‚¹ç­‰ã€‚</li>
</ol>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/06.png" alt="06" /></p>

<h3 id="babelcore">@babel/core</h3>

<p>Babel ç¼–è¯‘å™¨æœ¬èº«ï¼Œè¢«æ‹†åˆ†æˆäº†ä¸‰ä¸ªæ¨¡å—ï¼š<code class="language-plaintext highlighter-rouge">@babel/parser</code>ã€<code class="language-plaintext highlighter-rouge">@babel/traverse</code>ã€<code class="language-plaintext highlighter-rouge">@babel/generator</code>ï¼Œæ¯”å¦‚ä»¥ä¸‹æ–¹æ³•çš„å¯¼å…¥æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">).</span><span class="nx">parse</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">parse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/core</span><span class="dl">"</span><span class="p">).</span><span class="nx">parse</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">traverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/traverse</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">traverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/core</span><span class="dl">"</span><span class="p">).</span><span class="nx">traverse</span>
</code></pre></div></div>

<h3 id="babelparser">@babel/parser</h3>

<p><code class="language-plaintext highlighter-rouge">@babel/parser</code> å¯ä»¥å°† JavaScript ä»£ç è§£ææˆ AST è¯­æ³•æ ‘ï¼Œå…¶ä¸­ä¸»è¦æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">parser.parse(code, [{options}])</code>ï¼šè§£æä¸€æ®µ JavaScript ä»£ç ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">parser.parseExpression(code, [{options}])</code>ï¼šè€ƒè™‘åˆ°äº†æ€§èƒ½é—®é¢˜ï¼Œè§£æå•ä¸ª JavaScript è¡¨è¾¾å¼ã€‚</li>
</ul>

<p>éƒ¨åˆ†å¯é€‰å‚æ•° <code class="language-plaintext highlighter-rouge">options</code>ï¼š</p>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">allowImportExportEverywhere</code></td>
      <td>é»˜è®¤ <code class="language-plaintext highlighter-rouge">import</code> å’Œ <code class="language-plaintext highlighter-rouge">export</code> å£°æ˜è¯­å¥åªèƒ½å‡ºç°åœ¨ç¨‹åºçš„æœ€é¡¶å±‚ï¼Œè®¾ç½®ä¸º <code class="language-plaintext highlighter-rouge">true</code> åˆ™åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥å£°æ˜</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">allowReturnOutsideFunction</code></td>
      <td>é»˜è®¤å¦‚æœåœ¨é¡¶å±‚ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">return</code> è¯­å¥ä¼šå¼•èµ·é”™è¯¯ï¼Œè®¾ç½®ä¸º <code class="language-plaintext highlighter-rouge">true</code> å°±ä¸ä¼šæŠ¥é”™</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sourceType</code></td>
      <td>é»˜è®¤ä¸º <code class="language-plaintext highlighter-rouge">script</code>ï¼Œå½“ä»£ç ä¸­å«æœ‰ <code class="language-plaintext highlighter-rouge">import</code> ã€<code class="language-plaintext highlighter-rouge">export</code> ç­‰å…³é”®å­—æ—¶ä¼šæŠ¥é”™ï¼Œéœ€è¦æŒ‡å®šä¸º <code class="language-plaintext highlighter-rouge">module</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">errorRecovery</code></td>
      <td>é»˜è®¤å¦‚æœ babel å‘ç°ä¸€äº›ä¸æ­£å¸¸çš„ä»£ç å°±ä¼šæŠ›å‡ºé”™è¯¯ï¼Œè®¾ç½®ä¸º <code class="language-plaintext highlighter-rouge">true</code> åˆ™ä¼šåœ¨ä¿å­˜è§£æé”™è¯¯çš„åŒæ—¶ç»§ç»­è§£æä»£ç ï¼Œé”™è¯¯çš„è®°å½•å°†è¢«ä¿å­˜åœ¨æœ€ç»ˆç”Ÿæˆçš„ AST çš„ errors å±æ€§ä¸­ï¼Œå½“ç„¶å¦‚æœé‡åˆ°ä¸¥é‡çš„é”™è¯¯ï¼Œä¾ç„¶ä¼šç»ˆæ­¢è§£æ</td>
    </tr>
  </tbody>
</table>

<p>ä¸¾ä¸ªä¾‹å­çœ‹å¾—æ¯”è¾ƒæ¸…æ¥šï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">const a = 1;</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="p">{</span><span class="na">sourceType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">module</span><span class="dl">"</span><span class="p">})</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">{sourceType: "module"}</code> æ¼”ç¤ºäº†å¦‚ä½•æ·»åŠ å¯é€‰å‚æ•°ï¼Œè¾“å‡ºçš„å°±æ˜¯ AST è¯­æ³•æ ‘ï¼Œè¿™å’Œåœ¨çº¿ç½‘ç«™ <a href="https://astexplorer.net/">https://astexplorer.net/</a> è§£æå‡ºæ¥çš„è¯­æ³•æ ‘æ˜¯ä¸€æ ·çš„ï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/07.png" alt="07" /></p>

<h3 id="babelgenerator">@babel/generator</h3>

<p><code class="language-plaintext highlighter-rouge">@babel/generator</code> å¯ä»¥å°† AST è¿˜åŸæˆ JavaScript ä»£ç ï¼Œæä¾›äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">generate</code> æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">generate(ast, [{options}], code)</code>ã€‚</p>

<p>éƒ¨åˆ†å¯é€‰å‚æ•° <code class="language-plaintext highlighter-rouge">options</code>ï¼š</p>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">auxiliaryCommentBefore</code></td>
      <td>åœ¨è¾“å‡ºæ–‡ä»¶å†…å®¹çš„å¤´éƒ¨æ·»åŠ æ³¨é‡Šå—æ–‡å­—</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">auxiliaryCommentAfter</code></td>
      <td>åœ¨è¾“å‡ºæ–‡ä»¶å†…å®¹çš„æœ«å°¾æ·»åŠ æ³¨é‡Šå—æ–‡å­—</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">comments</code></td>
      <td>è¾“å‡ºå†…å®¹æ˜¯å¦åŒ…å«æ³¨é‡Š</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">compact</code></td>
      <td>è¾“å‡ºå†…å®¹æ˜¯å¦ä¸æ·»åŠ ç©ºæ ¼ï¼Œé¿å…æ ¼å¼åŒ–</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">concise</code></td>
      <td>è¾“å‡ºå†…å®¹æ˜¯å¦å‡å°‘ç©ºæ ¼ä½¿å…¶æ›´ç´§å‡‘ä¸€äº›</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">minified</code></td>
      <td>æ˜¯å¦å‹ç¼©è¾“å‡ºä»£ç </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">retainLines</code></td>
      <td>å°è¯•åœ¨è¾“å‡ºä»£ç ä¸­ä½¿ç”¨ä¸æºä»£ç ä¸­ç›¸åŒçš„è¡Œå·</td>
    </tr>
  </tbody>
</table>

<p>æ¥ç€å‰é¢çš„ä¾‹å­ï¼ŒåŸä»£ç æ˜¯ <code class="language-plaintext highlighter-rouge">const a = 1;</code>ï¼Œç°åœ¨æˆ‘ä»¬æŠŠ <code class="language-plaintext highlighter-rouge">a</code> å˜é‡ä¿®æ”¹ä¸º <code class="language-plaintext highlighter-rouge">b</code>ï¼Œå€¼ <code class="language-plaintext highlighter-rouge">1</code> ä¿®æ”¹ä¸º <code class="language-plaintext highlighter-rouge">2</code>ï¼Œç„¶åå°† AST è¿˜åŸç”Ÿæˆæ–°çš„ JS ä»£ç ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/generator</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>

<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">const a = 1;</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="p">{</span><span class="na">sourceType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">module</span><span class="dl">"</span><span class="p">})</span>
<span class="nx">ast</span><span class="p">.</span><span class="nx">program</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">declarations</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span>
<span class="nx">ast</span><span class="p">.</span><span class="nx">program</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">declarations</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">init</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">2</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="p">{</span><span class="na">minified</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span>
</code></pre></div></div>

<p>æœ€ç»ˆè¾“å‡ºçš„æ˜¯ <code class="language-plaintext highlighter-rouge">const b=2;</code>ï¼Œå˜é‡åå’Œå€¼éƒ½æˆåŠŸæ›´æ”¹äº†ï¼Œç”±äºåŠ äº†å‹ç¼©å¤„ç†ï¼Œç­‰å·å·¦å³ä¸¤è¾¹çš„ç©ºæ ¼ä¹Ÿæ²¡äº†ã€‚</p>

<p>ä»£ç é‡Œ <code class="language-plaintext highlighter-rouge">{minified: true}</code> æ¼”ç¤ºäº†å¦‚ä½•æ·»åŠ å¯é€‰å‚æ•°ï¼Œè¿™é‡Œè¡¨ç¤ºå‹ç¼©è¾“å‡ºä»£ç ï¼Œ<code class="language-plaintext highlighter-rouge">generate</code> å¾—åˆ°çš„ <code class="language-plaintext highlighter-rouge">result</code> å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­çš„ <code class="language-plaintext highlighter-rouge">code</code> å±æ€§æ‰æ˜¯æœ€ç»ˆçš„ JS ä»£ç ã€‚</p>

<p>ä»£ç é‡Œ <code class="language-plaintext highlighter-rouge">ast.program.body[0].declarations[0].id.name</code> æ˜¯ a åœ¨ AST ä¸­çš„ä½ç½®ï¼Œ<code class="language-plaintext highlighter-rouge">ast.program.body[0].declarations[0].init.value</code> æ˜¯ 1 åœ¨ AST ä¸­çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/08.png" alt="08" /></p>

<h3 id="babeltraverse">@babel/traverse</h3>

<p>å½“ä»£ç å¤šäº†ï¼Œæˆ‘ä»¬ä¸å¯èƒ½åƒå‰é¢é‚£æ ·æŒ¨ä¸ªå®šä½å¹¶ä¿®æ”¹ï¼Œå¯¹äºç›¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥éå†æ‰€æœ‰èŠ‚ç‚¹æ¥è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº† <code class="language-plaintext highlighter-rouge">@babel/traverse</code>ï¼Œå®ƒé€šå¸¸å’Œ <code class="language-plaintext highlighter-rouge">visitor</code> ä¸€èµ·ä½¿ç”¨ï¼Œ<code class="language-plaintext highlighter-rouge">visitor</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªåå­—æ˜¯å¯ä»¥éšæ„å–çš„ï¼Œ<code class="language-plaintext highlighter-rouge">visitor</code> é‡Œå¯ä»¥å®šä¹‰ä¸€äº›æ–¹æ³•æ¥è¿‡æ»¤èŠ‚ç‚¹ï¼Œè¿™é‡Œè¿˜æ˜¯ç”¨ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/generator</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">traverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/traverse</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>

<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="s2">`
const a = 1500;
const b = 60;
const c = "hi";
const d = 787;
const e = "1244";
`</span>
<span class="kd">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">NumericLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="p">},</span>
    <span class="nx">StringLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I Love JavaScript!</span><span class="dl">"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="nx">visitor</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™é‡Œçš„åŸå§‹ä»£ç å®šä¹‰äº† abcde äº”ä¸ªå˜é‡ï¼Œå…¶å€¼æœ‰æ•°å­—ä¹Ÿæœ‰å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬åœ¨ AST ä¸­å¯ä»¥çœ‹åˆ°å¯¹åº”çš„ç±»å‹ä¸º <code class="language-plaintext highlighter-rouge">NumericLiteral</code> å’Œ <code class="language-plaintext highlighter-rouge">StringLiteral</code>ï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/09.png" alt="09" /></p>

<p>ç„¶åæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">visitor</code> å¯¹è±¡ï¼Œç„¶åå®šä¹‰å¯¹åº”ç±»å‹çš„å¤„ç†æ–¹æ³•ï¼Œ<code class="language-plaintext highlighter-rouge">traverse</code> æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ AST å¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯ <code class="language-plaintext highlighter-rouge">visitor</code>ï¼Œå½“ <code class="language-plaintext highlighter-rouge">traverse</code> éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œé‡åˆ°èŠ‚ç‚¹ç±»å‹ä¸º <code class="language-plaintext highlighter-rouge">NumericLiteral</code> å’Œ <code class="language-plaintext highlighter-rouge">StringLiteral</code> æ—¶ï¼Œå°±ä¼šè°ƒç”¨ <code class="language-plaintext highlighter-rouge">visitor</code> ä¸­å¯¹åº”çš„å¤„ç†æ–¹æ³•ï¼Œ<code class="language-plaintext highlighter-rouge">visitor</code> ä¸­çš„æ–¹æ³•ä¼šæ¥æ”¶ä¸€ä¸ªå½“å‰èŠ‚ç‚¹çš„ <code class="language-plaintext highlighter-rouge">path</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ç±»å‹æ˜¯ <code class="language-plaintext highlighter-rouge">NodePath</code>ï¼Œè¯¥å¯¹è±¡æœ‰éå¸¸å¤šçš„å±æ€§ï¼Œä»¥ä¸‹ä»‹ç»å‡ ç§æœ€å¸¸ç”¨çš„ï¼š</p>

<table>
  <thead>
    <tr>
      <th>å±æ€§</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">toString()</code></td>
      <td>å½“å‰è·¯å¾„çš„æºç </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">node</code></td>
      <td>å½“å‰è·¯å¾„çš„èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">parent</code></td>
      <td>å½“å‰è·¯å¾„çš„çˆ¶çº§èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">parentPath</code></td>
      <td>å½“å‰è·¯å¾„çš„çˆ¶çº§è·¯å¾„</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">type</code></td>
      <td>å½“å‰è·¯å¾„çš„ç±»å‹</td>
    </tr>
  </tbody>
</table>

<p>PSï¼š<code class="language-plaintext highlighter-rouge">path</code> å¯¹è±¡é™¤äº†æœ‰å¾ˆå¤šå±æ€§ä»¥å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚æ›¿æ¢èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€æ’å…¥èŠ‚ç‚¹ã€å¯»æ‰¾çˆ¶çº§èŠ‚ç‚¹ã€è·å–åŒçº§èŠ‚ç‚¹ã€æ·»åŠ æ³¨é‡Šã€åˆ¤æ–­èŠ‚ç‚¹ç±»å‹ç­‰ï¼Œå¯åœ¨éœ€è¦æ—¶æŸ¥è¯¢ç›¸å…³æ–‡æ¡£æˆ–æŸ¥çœ‹æºç ï¼Œåç»­ä»‹ç» <code class="language-plaintext highlighter-rouge">@babel/types</code> éƒ¨åˆ†å°†ä¼šä¸¾éƒ¨åˆ†ä¾‹å­æ¥æ¼”ç¤ºï¼Œä»¥åçš„å®æˆ˜æ–‡ç« ä¸­ä¹Ÿä¼šæœ‰ç›¸å…³å®ä¾‹ï¼Œç¯‡å¹…æœ‰é™æœ¬æ–‡ä¸å†ç»†è¯´ã€‚</p>

<p>å› æ­¤åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">path.node.value</code> å°±æ‹¿åˆ°äº†å˜é‡çš„å€¼ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥å¯¹å…¶è¿›è¡Œä¿®æ”¹äº†ã€‚ä»¥ä¸Šä»£ç è¿è¡Œåï¼Œæ‰€æœ‰æ•°å­—éƒ½ä¼šåŠ ä¸Š100åå†ä¹˜ä»¥2ï¼Œæ‰€æœ‰å­—ç¬¦ä¸²éƒ½ä¼šè¢«æ›¿æ¢æˆ <code class="language-plaintext highlighter-rouge">I Love JavaScript!</code>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">3200</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">320</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I Love JavaScript!</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="mi">1774</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I Love JavaScript!</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<p>å¦‚æœå¤šä¸ªç±»å‹çš„èŠ‚ç‚¹ï¼Œå¤„ç†çš„æ–¹å¼éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">|</code> å°†æ‰€æœ‰èŠ‚ç‚¹è¿æ¥æˆå­—ç¬¦ä¸²ï¼Œå°†åŒä¸€ä¸ªæ–¹æ³•åº”ç”¨åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">NumericLiteral|StringLiteral</span><span class="dl">"</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I Love JavaScript!</span><span class="dl">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">visitor</code> å¯¹è±¡æœ‰å¤šç§å†™æ³•ï¼Œä»¥ä¸‹å‡ ç§å†™æ³•çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">NumericLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="p">},</span>
    <span class="nx">StringLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I Love JavaScript!</span><span class="dl">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">NumericLiteral</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">){</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="p">},</span>
    <span class="na">StringLiteral</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">){</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I Love JavaScript!</span><span class="dl">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">NumericLiteral</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">enter</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">StringLiteral</span><span class="p">:</span> <span class="p">{</span>
        <span class="nx">enter</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I Love JavaScript!</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">enter</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">NumericLiteral</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">StringLiteral</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">I Love JavaScript!</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä»¥ä¸Šå‡ ç§å†™æ³•ä¸­æœ‰ç”¨åˆ°äº† <code class="language-plaintext highlighter-rouge">enter</code> æ–¹æ³•ï¼Œåœ¨èŠ‚ç‚¹çš„éå†è¿‡ç¨‹ä¸­ï¼Œè¿›å…¥èŠ‚ç‚¹ï¼ˆenterï¼‰ä¸é€€å‡ºï¼ˆexitï¼‰èŠ‚ç‚¹éƒ½ä¼šè®¿é—®ä¸€æ¬¡èŠ‚ç‚¹ï¼Œ<code class="language-plaintext highlighter-rouge">traverse</code> é»˜è®¤åœ¨è¿›å…¥èŠ‚ç‚¹æ—¶è¿›è¡ŒèŠ‚ç‚¹çš„å¤„ç†ï¼Œå¦‚æœè¦åœ¨é€€å‡ºèŠ‚ç‚¹æ—¶å¤„ç†ï¼Œé‚£ä¹ˆåœ¨ <code class="language-plaintext highlighter-rouge">visitor</code> ä¸­å°±å¿…é¡»å£°æ˜ <code class="language-plaintext highlighter-rouge">exit</code> æ–¹æ³•ã€‚</p>

<h3 id="babeltypes">@babel/types</h3>

<p><code class="language-plaintext highlighter-rouge">@babel/types</code> ä¸»è¦ç”¨äºæ„å»ºæ–°çš„ AST èŠ‚ç‚¹ï¼Œå‰é¢çš„ç¤ºä¾‹ä»£ç ä¸º <code class="language-plaintext highlighter-rouge">const a = 1;</code>ï¼Œå¦‚æœæƒ³è¦å¢åŠ å†…å®¹ï¼Œæ¯”å¦‚å˜æˆ <code class="language-plaintext highlighter-rouge">const a = 1; const b = a * 5 + 1;</code>ï¼Œå°±å¯ä»¥é€šè¿‡ <code class="language-plaintext highlighter-rouge">@babel/types</code> æ¥å®ç°ã€‚</p>

<p>é¦–å…ˆè§‚å¯Ÿä¸€ä¸‹ AST è¯­æ³•æ ‘ï¼ŒåŸè¯­å¥åªæœ‰ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">VariableDeclaration</code> èŠ‚ç‚¹ï¼Œç°åœ¨å¢åŠ äº†ä¸€ä¸ªï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/10.png" alt="10" /></p>

<p>é‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å°±æ˜¯åœ¨éå†èŠ‚ç‚¹æ—¶ï¼Œéå†åˆ° <code class="language-plaintext highlighter-rouge">VariableDeclaration</code> èŠ‚ç‚¹ï¼Œå°±åœ¨å…¶åé¢å¢åŠ ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">VariableDeclaration</code> èŠ‚ç‚¹ï¼Œç”Ÿæˆ  <code class="language-plaintext highlighter-rouge">VariableDeclaration</code> èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">types.variableDeclaration()</code> æ–¹æ³•ï¼Œåœ¨ types ä¸­å„ç§æ–¹æ³•åç§°å’Œæˆ‘ä»¬åœ¨ AST ä¸­çœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡é¦–å­—æ¯æ˜¯å°å†™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“æ‰€æœ‰æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¤§è‡´æ¨æ–­å…¶æ–¹æ³•åï¼ŒåªçŸ¥é“è¿™ä¸ªæ–¹æ³•è¿˜ä¸è¡Œï¼Œè¿˜å¾—çŸ¥é“ä¼ å…¥çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥æŸ¥æ–‡æ¡£ï¼Œä¸è¿‡è¿™é‡Œæ¨èç›´æ¥çœ‹æºç ï¼Œéå¸¸æ¸…æ™°æ˜äº†ï¼Œä»¥ Pycharm ä¸ºä¾‹ï¼ŒæŒ‰ä½ Ctrl é”®ï¼Œå†ç‚¹å‡»æ–¹æ³•åï¼Œå°±è¿›åˆ°æºç é‡Œäº†ï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/11.png" alt="11" /></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">variableDeclaration</span><span class="p">(</span><span class="nx">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">var</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">let</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">const</span><span class="dl">"</span><span class="p">,</span> <span class="nx">declarations</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">BabelNodeVariableDeclarator</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°éœ€è¦ <code class="language-plaintext highlighter-rouge">kind</code> å’Œ <code class="language-plaintext highlighter-rouge">declarations</code> ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ <code class="language-plaintext highlighter-rouge">declarations</code> æ˜¯ <code class="language-plaintext highlighter-rouge">VariableDeclarator</code> ç±»å‹çš„èŠ‚ç‚¹ç»„æˆçš„åˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå†™å‡ºä»¥ä¸‹ <code class="language-plaintext highlighter-rouge">visitor</code> éƒ¨åˆ†çš„ä»£ç ï¼Œå…¶ä¸­ <code class="language-plaintext highlighter-rouge">path.insertAfter()</code> æ˜¯åœ¨è¯¥èŠ‚ç‚¹ä¹‹åæ’å…¥æ–°èŠ‚ç‚¹çš„æ„æ€ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">VariableDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">declaration</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">variableDeclaration</span><span class="p">(</span><span class="dl">"</span><span class="s2">const</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">declarator</span><span class="p">])</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">declaration</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦è¿›ä¸€æ­¥å®šä¹‰ <code class="language-plaintext highlighter-rouge">declarator</code>ï¼Œä¹Ÿå°±æ˜¯ <code class="language-plaintext highlighter-rouge">VariableDeclarator</code> ç±»å‹çš„èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢å…¶æºç å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">variableDeclarator</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="nx">BabelNodeLVal</span><span class="p">,</span> <span class="nx">init</span><span class="p">?:</span> <span class="nx">BabelNodeExpression</span><span class="p">)</span>
</code></pre></div></div>

<p>è§‚å¯Ÿ ASTï¼Œid ä¸º <code class="language-plaintext highlighter-rouge">Identifier</code> å¯¹è±¡ï¼Œinit ä¸º <code class="language-plaintext highlighter-rouge">BinaryExpression</code> å¯¹è±¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/12.png" alt="12" /></p>

<p>å…ˆæ¥å¤„ç† idï¼Œå¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">types.identifier()</code> æ–¹æ³•æ¥ç”Ÿæˆï¼Œå…¶æºç ä¸º <code class="language-plaintext highlighter-rouge">function identifier(name: string)</code>ï¼Œname åœ¨è¿™é‡Œå°±æ˜¯ b äº†ï¼Œæ­¤æ—¶ <code class="language-plaintext highlighter-rouge">visitor</code> ä»£ç å°±å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">VariableDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">declarator</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">variableDeclarator</span><span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">),</span> <span class="nx">init</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">declaration</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">variableDeclaration</span><span class="p">(</span><span class="dl">"</span><span class="s2">const</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">declarator</span><span class="p">])</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">declaration</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç„¶åå†æ¥çœ‹ init è¯¥å¦‚ä½•å®šä¹‰ï¼Œé¦–å…ˆä»ç„¶æ˜¯çœ‹ AST ç»“æ„ï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/13.png" alt="13" /></p>

<p>init ä¸º <code class="language-plaintext highlighter-rouge">BinaryExpression</code> å¯¹è±¡ï¼Œleft å·¦è¾¹æ˜¯ <code class="language-plaintext highlighter-rouge">BinaryExpression</code>ï¼Œright å³è¾¹æ˜¯ <code class="language-plaintext highlighter-rouge">NumericLiteral</code>ï¼Œå¯ä»¥ç”¨ <code class="language-plaintext highlighter-rouge">types.binaryExpression()</code> æ–¹æ³•æ¥ç”Ÿæˆ initï¼Œå…¶æºç å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">binaryExpression</span><span class="p">(</span>
    <span class="nx">operator</span><span class="p">:</span> <span class="dl">"</span><span class="s2">+</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">-</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">%</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">**</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">&amp;</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">|</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">&gt;&gt;</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">&gt;&gt;&gt;</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">&lt;&lt;</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">^</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">==</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">===</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">!=</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">!==</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">in</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">instanceof</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">&gt;</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">&lt;</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">&gt;=</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">&lt;=</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">left</span><span class="p">:</span> <span class="nx">BabelNodeExpression</span> <span class="o">|</span> <span class="nx">BabelNodePrivateName</span><span class="p">,</span> 
    <span class="nx">right</span><span class="p">:</span> <span class="nx">BabelNodeExpression</span>
<span class="p">)</span>
</code></pre></div></div>

<p>æ­¤æ—¶ <code class="language-plaintext highlighter-rouge">visitor</code> ä»£ç å°±å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">VariableDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">init</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">binaryExpression</span><span class="p">(</span><span class="dl">"</span><span class="s2">+</span><span class="dl">"</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">declarator</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">variableDeclarator</span><span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">),</span> <span class="nx">init</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">declaration</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">variableDeclaration</span><span class="p">(</span><span class="dl">"</span><span class="s2">const</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">declarator</span><span class="p">])</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">declaration</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç„¶åç»§ç»­æ„é€  left å’Œ rightï¼Œå’Œå‰é¢çš„æ–¹æ³•ä¸€æ ·ï¼Œè§‚å¯Ÿ AST è¯­æ³•æ ‘ï¼ŒæŸ¥è¯¢å¯¹åº”æ–¹æ³•åº”è¯¥ä¼ å…¥çš„å‚æ•°ï¼Œå±‚å±‚åµŒå¥—ï¼Œç›´åˆ°æŠŠæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ„é€ å®Œæ¯•ï¼Œæœ€ç»ˆçš„ <code class="language-plaintext highlighter-rouge">visitor</code> ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">VariableDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">binaryExpression</span><span class="p">(</span><span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">,</span> <span class="nx">types</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">),</span> <span class="nx">types</span><span class="p">.</span><span class="nx">numericLiteral</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="kd">let</span> <span class="nx">right</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">numericLiteral</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">init</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">binaryExpression</span><span class="p">(</span><span class="dl">"</span><span class="s2">+</span><span class="dl">"</span><span class="p">,</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">declarator</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">variableDeclarator</span><span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">),</span> <span class="nx">init</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">declaration</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">variableDeclaration</span><span class="p">(</span><span class="dl">"</span><span class="s2">const</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">declarator</span><span class="p">])</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">declaration</span><span class="p">)</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ³¨æ„ï¼š<code class="language-plaintext highlighter-rouge">path.insertAfter()</code> æ’å…¥èŠ‚ç‚¹è¯­å¥åé¢åŠ äº†ä¸€å¥ <code class="language-plaintext highlighter-rouge">path.stop()</code>ï¼Œè¡¨ç¤ºæ’å…¥å®Œæˆåç«‹å³åœæ­¢éå†å½“å‰èŠ‚ç‚¹å’Œåç»­çš„å­èŠ‚ç‚¹ï¼Œæ·»åŠ çš„æ–°èŠ‚ç‚¹ä¹Ÿæ˜¯ <code class="language-plaintext highlighter-rouge">VariableDeclaration</code>ï¼Œå¦‚æœä¸åŠ åœæ­¢è¯­å¥çš„è¯ï¼Œå°±ä¼šæ— é™å¾ªç¯æ’å…¥ä¸‹å»ã€‚</p>

<p>æ’å…¥æ–°èŠ‚ç‚¹åï¼Œå†è½¬æ¢æˆ JavaScript ä»£ç ï¼Œå°±å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€è¡Œæ–°ä»£ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/14.png" alt="14" /></p>

<h2 id="å¸¸è§æ··æ·†è¿˜åŸ">å¸¸è§æ··æ·†è¿˜åŸ</h2>

<p>äº†è§£äº† AST å’Œ babel åï¼Œå°±å¯ä»¥å¯¹ JavaScript æ··æ·†ä»£ç è¿›è¡Œè¿˜åŸäº†ï¼Œä»¥ä¸‹æ˜¯éƒ¨åˆ†æ ·ä¾‹ï¼Œå¸¦ä½ è¿›ä¸€æ­¥ç†Ÿæ‚‰ babel çš„å„ç§æ“ä½œã€‚</p>

<h3 id="å­—ç¬¦ä¸²è¿˜åŸ">å­—ç¬¦ä¸²è¿˜åŸ</h3>

<p>æ–‡ç« å¼€å¤´çš„å›¾ä¸­ä¸¾äº†ä¸ªä¾‹å­ï¼Œæ­£å¸¸å­—ç¬¦è¢«æ¢æˆäº† Unicode ç¼–ç ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">[</span><span class="dl">'</span><span class="se">\</span><span class="s1">u006c</span><span class="se">\</span><span class="s1">u006f</span><span class="se">\</span><span class="s1">u0067</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="se">\</span><span class="s1">u0048</span><span class="se">\</span><span class="s1">u0065</span><span class="se">\</span><span class="s1">u006c</span><span class="se">\</span><span class="s1">u006c</span><span class="se">\</span><span class="s1">u006f</span><span class="se">\</span><span class="s1">u0020</span><span class="se">\</span><span class="s1">u0077</span><span class="se">\</span><span class="s1">u006f</span><span class="se">\</span><span class="s1">u0072</span><span class="se">\</span><span class="s1">u006c</span><span class="se">\</span><span class="s1">u0064</span><span class="se">\</span><span class="s1">u0021</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<p>è§‚å¯Ÿ AST ç»“æ„ï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/15.png" alt="15" /></p>

<p>æˆ‘ä»¬å‘ç° Unicode ç¼–ç å¯¹åº”çš„æ˜¯ <code class="language-plaintext highlighter-rouge">raw</code>ï¼Œè€Œ <code class="language-plaintext highlighter-rouge">rawValue</code> å’Œ <code class="language-plaintext highlighter-rouge">value</code> éƒ½æ˜¯æ­£å¸¸çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°† <code class="language-plaintext highlighter-rouge">raw</code> æ›¿æ¢æˆ <code class="language-plaintext highlighter-rouge">rawValue</code> æˆ– <code class="language-plaintext highlighter-rouge">value</code> å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¼•å·çš„é—®é¢˜ï¼Œæœ¬æ¥æ˜¯ <code class="language-plaintext highlighter-rouge">console["log"]</code>ï¼Œä½ è¿˜åŸåå˜æˆäº† <code class="language-plaintext highlighter-rouge">console[log]</code>ï¼Œè‡ªç„¶ä¼šæŠ¥é”™çš„ï¼Œé™¤äº†æ›¿æ¢å€¼ä»¥å¤–ï¼Œè¿™é‡Œç›´æ¥åˆ é™¤ extra èŠ‚ç‚¹ï¼Œæˆ–è€…åˆ é™¤ raw å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ‰€ä»¥ä»¥ä¸‹å‡ ç§å†™æ³•éƒ½å¯ä»¥è¿˜åŸä»£ç ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/generator</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">traverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/traverse</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>

<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="s2">`console['\u006c\u006f\u0067']('\u0048\u0065\u006c\u006c\u006f\u0020\u0077\u006f\u0072\u006c\u0064\u0021')`</span>
<span class="kd">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">StringLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ä»¥ä¸‹æ–¹æ³•å‡å¯</span>
        <span class="c1">// path.node.extra.raw = path.node.rawValue</span>
        <span class="c1">// path.node.extra.raw = '"' + path.node.value + '"'</span>
        <span class="c1">// delete path.node.extra</span>
        <span class="k">delete</span> <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">extra</span><span class="p">.</span><span class="nx">raw</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="nx">visitor</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿˜åŸç»“æœï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">[</span><span class="dl">"</span><span class="s2">log</span><span class="dl">"</span><span class="p">](</span><span class="dl">"</span><span class="s2">Hello world!</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="è¡¨è¾¾å¼è¿˜åŸ">è¡¨è¾¾å¼è¿˜åŸ</h3>

<p>ä¹‹å‰å†™è¿‡ <a href="https://itrhx.blog.csdn.net/article/details/122057377">JSFuck æ··æ·†çš„è¿˜åŸ</a>ï¼Œå…¶ä¸­æœ‰ä»‹ç» <code class="language-plaintext highlighter-rouge">![]</code> å¯è¡¨ç¤º falseï¼Œ<code class="language-plaintext highlighter-rouge">!![]</code> æˆ–è€… <code class="language-plaintext highlighter-rouge">!+[]</code> å¯è¡¨ç¤º trueï¼Œåœ¨ä¸€äº›æ··æ·†ä»£ç ä¸­ï¼Œç»å¸¸æœ‰è¿™äº›æ“ä½œï¼ŒæŠŠç®€å•çš„è¡¨è¾¾å¼å¤æ‚åŒ–ï¼Œå¾€å¾€éœ€è¦æ‰§è¡Œä¸€ä¸‹è¯­å¥ï¼Œæ‰èƒ½å¾—åˆ°çœŸæ­£çš„ç»“æœï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="o">!!</span><span class="p">[]</span><span class="o">+!!</span><span class="p">[]</span><span class="o">+!!</span><span class="p">[];</span>
<span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="mf">12.34</span> <span class="o">*</span> <span class="mf">2.12</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="mf">21.3</span> <span class="o">+</span> <span class="mi">14</span> <span class="o">*</span> <span class="mf">1.32</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="dl">"</span><span class="s2">1.893</span><span class="dl">"</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">45.9088</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">f</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="dl">"</span><span class="s2">23.2334</span><span class="dl">"</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">21.89112</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">g</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">&lt;</span> <span class="mi">18</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">æœªæˆå¹´</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">æˆå¹´</span><span class="dl">'</span>
</code></pre></div></div>

<p>æƒ³è¦æ‰§è¡Œè¯­å¥ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ <code class="language-plaintext highlighter-rouge">path.evaluate()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹ path å¯¹è±¡è¿›è¡Œæ‰§è¡Œæ“ä½œï¼Œè‡ªåŠ¨è®¡ç®—å‡ºç»“æœï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­çš„ <code class="language-plaintext highlighter-rouge">confident</code> å±æ€§è¡¨ç¤ºç½®ä¿¡åº¦ï¼Œ<code class="language-plaintext highlighter-rouge">value</code> è¡¨ç¤ºè®¡ç®—ç»“æœï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">types.valueToNode()</code> æ–¹æ³•åˆ›å»ºèŠ‚ç‚¹ï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">path.replaceInline()</code> æ–¹æ³•å°†èŠ‚ç‚¹æ›¿æ¢æˆè®¡ç®—ç»“æœç”Ÿæˆçš„æ–°èŠ‚ç‚¹ï¼Œæ›¿æ¢æ–¹æ³•æœ‰ä¸€ä¸‹å‡ ç§ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">replaceWith</code>ï¼šç”¨ä¸€ä¸ªèŠ‚ç‚¹æ›¿æ¢å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">replaceWithMultiple</code>ï¼šç”¨å¤šä¸ªèŠ‚ç‚¹æ›¿æ¢å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">replaceWithSourceString</code>ï¼šå°†ä¼ å…¥çš„æºç å­—ç¬¦ä¸²è§£ææˆå¯¹åº” Node åå†æ›¿æ¢ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">replaceInline</code>ï¼šç”¨ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹æ›¿æ¢å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›¸å½“äºåŒæ—¶æœ‰äº†å‰ä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ã€‚</li>
</ul>

<p>å¯¹åº”çš„ AST å¤„ç†ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/generator</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">traverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/traverse</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/types</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="s2">`
const a = !![]+!![]+!![];
const b = Math.floor(12.34 * 2.12)
const c = 10 &gt;&gt; 3 &lt;&lt; 1
const d = String(21.3 + 14 * 1.32)
const e = parseInt("1.893" + "45.9088")
const f = parseFloat("23.2334" + "21.89112")
const g = 20 &lt; 18 ? 'æœªæˆå¹´' : 'æˆå¹´'
`</span>
<span class="kd">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">BinaryExpression|CallExpression|ConditionalExpression</span><span class="dl">"</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="p">{</span><span class="nx">confident</span><span class="p">,</span> <span class="nx">value</span><span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confident</span><span class="p">){</span>
            <span class="nx">path</span><span class="p">.</span><span class="nx">replaceInline</span><span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">valueToNode</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="nx">visitor</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span>
</code></pre></div></div>

<p>æœ€ç»ˆç»“æœï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">39.78</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="dl">"</span><span class="s2">1.89345.9088</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">f</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="dl">"</span><span class="s2">23.233421.89112</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">g</span> <span class="o">=</span> <span class="dl">"</span><span class="se">\</span><span class="s2">u6210</span><span class="se">\</span><span class="s2">u5E74</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="åˆ é™¤æœªä½¿ç”¨å˜é‡">åˆ é™¤æœªä½¿ç”¨å˜é‡</h3>

<p>æœ‰æ—¶å€™ä»£ç é‡Œä¼šæœ‰ä¸€äº›å¹¶æ²¡æœ‰ä½¿ç”¨åˆ°çš„å¤šä½™å˜é‡ï¼Œåˆ é™¤è¿™äº›å¤šä½™å˜é‡æœ‰åŠ©äºæ›´åŠ é«˜æ•ˆçš„åˆ†æä»£ç ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
</code></pre></div></div>

<p>åˆ é™¤å¤šä½™å˜é‡ï¼Œé¦–å…ˆè¦äº†è§£ <code class="language-plaintext highlighter-rouge">NodePath</code> ä¸­çš„ <code class="language-plaintext highlighter-rouge">scope</code>ï¼Œ<code class="language-plaintext highlighter-rouge">scope</code> çš„ä½œç”¨ä¸»è¦æ˜¯æŸ¥æ‰¾æ ‡è¯†ç¬¦çš„ä½œç”¨åŸŸã€è·å–å¹¶ä¿®æ”¹æ ‡è¯†ç¬¦çš„æ‰€æœ‰å¼•ç”¨ç­‰ï¼Œåˆ é™¤æœªä½¿ç”¨å˜é‡ä¸»è¦ç”¨åˆ°äº† <code class="language-plaintext highlighter-rouge">scope.getBinding()</code> æ–¹æ³•ï¼Œä¼ å…¥çš„å€¼æ˜¯å½“å‰èŠ‚ç‚¹èƒ½å¤Ÿå¼•ç”¨åˆ°çš„æ ‡è¯†ç¬¦åç§°ï¼Œè¿”å›çš„å…³é”®å±æ€§æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">identifier</code>ï¼šæ ‡è¯†ç¬¦çš„ Node å¯¹è±¡ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">path</code>ï¼šæ ‡è¯†ç¬¦çš„ NodePath å¯¹è±¡ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">constant</code>ï¼šæ ‡è¯†ç¬¦æ˜¯å¦ä¸ºå¸¸é‡ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">referenced</code>ï¼šæ ‡è¯†ç¬¦æ˜¯å¦è¢«å¼•ç”¨ï¼›</li>
  <li>` references`ï¼šæ ‡è¯†ç¬¦è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">constantViolations</code>ï¼šå¦‚æœæ ‡è¯†ç¬¦è¢«ä¿®æ”¹ï¼Œåˆ™ä¼šå­˜æ”¾æ‰€æœ‰ä¿®æ”¹è¯¥æ ‡è¯†ç¬¦èŠ‚ç‚¹çš„ Path å¯¹è±¡ï¼›</li>
  <li><code class="language-plaintext highlighter-rouge">referencePaths</code>ï¼šå¦‚æœæ ‡è¯†ç¬¦è¢«å¼•ç”¨ï¼Œåˆ™ä¼šå­˜æ”¾æ‰€æœ‰å¼•ç”¨è¯¥æ ‡è¯†ç¬¦èŠ‚ç‚¹çš„ Path å¯¹è±¡ã€‚</li>
</ul>

<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code class="language-plaintext highlighter-rouge">constantViolations</code>ã€<code class="language-plaintext highlighter-rouge">referenced</code>ã€<code class="language-plaintext highlighter-rouge">references</code>ã€<code class="language-plaintext highlighter-rouge">referencePaths</code> å¤šä¸ªå‚æ•°æ¥åˆ¤æ–­å˜é‡æ˜¯å¦å¯ä»¥è¢«åˆ é™¤ï¼ŒAST å¤„ç†ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/generator</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">traverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/traverse</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>

<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="s2">`
const a = 1;
const b = a * 2;
const c = 2;
const d = b + 1;
const e = 3;
console.log(d)
`</span>
<span class="kd">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">VariableDeclarator</span><span class="p">(</span><span class="nx">path</span><span class="p">){</span>
        <span class="kd">const</span> <span class="nx">binding</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">getBinding</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

        <span class="c1">// å¦‚æ ‡è¯†ç¬¦è¢«ä¿®æ”¹è¿‡ï¼Œåˆ™ä¸èƒ½è¿›è¡Œåˆ é™¤åŠ¨ä½œã€‚</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">binding</span> <span class="o">||</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">constantViolations</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// æœªè¢«å¼•ç”¨</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">binding</span><span class="p">.</span><span class="nx">referenced</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// è¢«å¼•ç”¨æ¬¡æ•°ä¸º0</span>
        <span class="c1">// if (binding.references === 0) {</span>
        <span class="c1">//     path.remove();</span>
        <span class="c1">// }</span>

        <span class="c1">// é•¿åº¦ä¸º0ï¼Œå˜é‡æ²¡æœ‰è¢«å¼•ç”¨è¿‡</span>
        <span class="c1">// if (binding.referencePaths.length === 0) {</span>
        <span class="c1">//     path.remove();</span>
        <span class="c1">// }</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="nx">visitor</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span>
</code></pre></div></div>

<p>å¤„ç†åçš„ä»£ç ï¼ˆæœªä½¿ç”¨çš„ bã€cã€e å˜é‡å·²è¢«åˆ é™¤ï¼‰ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="åˆ é™¤å†—ä½™é€»è¾‘ä»£ç ">åˆ é™¤å†—ä½™é€»è¾‘ä»£ç </h3>

<p>æœ‰æ—¶å€™ä¸ºäº†å¢åŠ é€†å‘éš¾åº¦ï¼Œä¼šæœ‰å¾ˆå¤šåµŒå¥—çš„ if-else è¯­å¥ï¼Œå¤§é‡åˆ¤æ–­ä¸ºå‡çš„å†—ä½™é€»è¾‘ä»£ç ï¼ŒåŒæ ·å¯ä»¥åˆ©ç”¨ AST å°†å…¶åˆ é™¤æ‰ï¼Œåªç•™ä¸‹åˆ¤æ–­ä¸ºçœŸçš„ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">a</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>è§‚å¯Ÿ ASTï¼Œåˆ¤æ–­æ¡ä»¶å¯¹åº”çš„æ˜¯ <code class="language-plaintext highlighter-rouge">test</code> èŠ‚ç‚¹ï¼Œif å¯¹åº”çš„æ˜¯ <code class="language-plaintext highlighter-rouge">consequent</code> èŠ‚ç‚¹ï¼Œelse å¯¹åº”çš„æ˜¯ <code class="language-plaintext highlighter-rouge">alternate</code> èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img src="https://static.spiderapi.cn/itbob/images/article/051/16.png" alt="16" /></p>

<p>AST å¤„ç†æ€è·¯ä»¥åŠä»£ç ï¼š</p>

<ol>
  <li>ç­›é€‰å‡º <code class="language-plaintext highlighter-rouge">BooleanLiteral</code> å’Œ <code class="language-plaintext highlighter-rouge">NumericLiteral</code> èŠ‚ç‚¹ï¼Œå–å…¶å¯¹åº”çš„å€¼ï¼Œå³ <code class="language-plaintext highlighter-rouge">path.node.test.value</code>ï¼›</li>
  <li>åˆ¤æ–­ <code class="language-plaintext highlighter-rouge">value</code> å€¼ä¸ºçœŸï¼Œåˆ™å°†èŠ‚ç‚¹æ›¿æ¢æˆ <code class="language-plaintext highlighter-rouge">consequent</code> èŠ‚ç‚¹ä¸‹çš„å†…å®¹ï¼Œå³ <code class="language-plaintext highlighter-rouge">path.node.consequent.body</code>ï¼›</li>
  <li>åˆ¤æ–­ <code class="language-plaintext highlighter-rouge">value</code> å€¼ä¸ºå‡ï¼Œåˆ™æ›¿æ¢æˆ <code class="language-plaintext highlighter-rouge">alternate</code> èŠ‚ç‚¹ä¸‹çš„å†…å®¹ï¼Œå³ <code class="language-plaintext highlighter-rouge">path.node.alternate.body</code>ï¼›</li>
  <li>æœ‰çš„ if è¯­å¥å¯èƒ½æ²¡æœ‰å†™ elseï¼Œä¹Ÿå°±æ²¡æœ‰ <code class="language-plaintext highlighter-rouge">alternate</code>ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹åˆ¤æ–­ <code class="language-plaintext highlighter-rouge">value</code> å€¼ä¸ºå‡ï¼Œåˆ™ç›´æ¥ç§»é™¤è¯¥èŠ‚ç‚¹ï¼Œå³ <code class="language-plaintext highlighter-rouge">path.remove()</code></li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/generator</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">traverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/traverse</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@babel/types</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="s2">`
const example = function () {
    let a;
    if (false) {
        a = 1;
    } else {
        if (1) {
            a = 2;
        }
        else {
            a = 3;
        }
    }
    return a;
};
`</span>
<span class="kd">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">enter</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">isBooleanLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">test</span><span class="p">)</span> <span class="o">||</span> <span class="nx">types</span><span class="p">.</span><span class="nx">isNumericLiteral</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">test</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">path</span><span class="p">.</span><span class="nx">replaceInline</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">consequent</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">alternate</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">path</span><span class="p">.</span><span class="nx">replaceInline</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">alternate</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="nx">visitor</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span>
</code></pre></div></div>

<p>å¤„ç†ç»“æœï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">a</span><span class="p">;</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="switch-case-åæ§åˆ¶æµå¹³å¦åŒ–">switch-case åæ§åˆ¶æµå¹³å¦åŒ–</h3>

<p>æ§åˆ¶æµå¹³å¦åŒ–æ˜¯æ··æ·†å½“ä¸­æœ€å¸¸è§çš„ï¼Œé€šè¿‡ <code class="language-plaintext highlighter-rouge">if-else</code> æˆ–è€… <code class="language-plaintext highlighter-rouge">while-switch-case</code> è¯­å¥åˆ†è§£æ­¥éª¤ï¼Œç¤ºä¾‹ä»£ç ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">_0x34e16a</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">3,4,0,5,1,2</span><span class="dl">'</span><span class="p">[</span><span class="dl">'</span><span class="s1">split</span><span class="dl">'</span><span class="p">](</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">_0x2eff02</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!!</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">_0x34e16a</span><span class="p">[</span><span class="nx">_0x2eff02</span><span class="o">++</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">case</span><span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">:</span>
            <span class="kd">let</span> <span class="nx">_0x38cb15</span> <span class="o">=</span> <span class="nx">_0x4588f1</span> <span class="o">+</span> <span class="nx">_0x470e97</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">case</span><span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">:</span>
            <span class="kd">let</span> <span class="nx">_0x1e0e5e</span> <span class="o">=</span> <span class="nx">_0x37b9f3</span><span class="p">[</span><span class="nx">_0x50cee0</span><span class="p">(</span><span class="mh">0x2e0</span><span class="p">,</span> <span class="mh">0x2e8</span><span class="p">,</span> <span class="mh">0x2e1</span><span class="p">,</span> <span class="mh">0x2e4</span><span class="p">)];</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">case</span><span class="dl">'</span><span class="s1">2</span><span class="dl">'</span><span class="p">:</span>
            <span class="kd">let</span> <span class="nx">_0x35d732</span> <span class="o">=</span> <span class="p">[</span><span class="nx">_0x388d4b</span><span class="p">(</span><span class="o">-</span><span class="mh">0x134</span><span class="p">,</span> <span class="o">-</span><span class="mh">0x134</span><span class="p">,</span> <span class="o">-</span><span class="mh">0x139</span><span class="p">,</span> <span class="o">-</span><span class="mh">0x138</span><span class="p">)](</span><span class="nx">_0x38cb15</span> <span class="o">&gt;&gt;</span> <span class="nx">_0x4588f1</span><span class="p">);</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">case</span><span class="dl">'</span><span class="s1">3</span><span class="dl">'</span><span class="p">:</span>
            <span class="kd">let</span> <span class="nx">_0x4588f1</span> <span class="o">=</span> <span class="mh">0x1</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">case</span><span class="dl">'</span><span class="s1">4</span><span class="dl">'</span><span class="p">:</span>
            <span class="kd">let</span> <span class="nx">_0x470e97</span> <span class="o">=</span> <span class="mh">0x2</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">case</span><span class="dl">'</span><span class="s1">5</span><span class="dl">'</span><span class="p">:</span>
            <span class="kd">let</span> <span class="nx">_0x37b9f3</span> <span class="o">=</span> <span class="mh">0x5</span> <span class="o">||</span> <span class="nx">_0x38cb15</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>AST è¿˜åŸæ€è·¯ï¼š</p>

<ol>
  <li>è·å–æ§åˆ¶æµåŸå§‹æ•°ç»„ï¼Œå°† <code class="language-plaintext highlighter-rouge">'3,4,0,5,1,2'['split'](',')</code> ä¹‹ç±»çš„è¯­å¥è½¬åŒ–æˆ <code class="language-plaintext highlighter-rouge">['3','4','0','5','1','2']</code> ä¹‹ç±»çš„æ•°ç»„ï¼Œå¾—åˆ°è¯¥æ•°ç»„ä¹‹åï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æŠŠ split è¯­å¥å¯¹åº”çš„èŠ‚ç‚¹åˆ é™¤æ‰ï¼Œå› ä¸ºæœ€ç»ˆä»£ç é‡Œè¿™æ¡è¯­å¥å°±æ²¡ç”¨äº†ï¼›</li>
  <li>éå†ç¬¬ä¸€æ­¥å¾—åˆ°çš„æ§åˆ¶æµæ•°ç»„ï¼Œä¾æ¬¡å–å‡ºæ¯ä¸ªå€¼æ‰€å¯¹åº”çš„ case èŠ‚ç‚¹ï¼›</li>
  <li>å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œå‚¨å­˜æ¯ä¸ª case èŠ‚ç‚¹ <code class="language-plaintext highlighter-rouge">consequent</code> æ•°ç»„é‡Œé¢çš„å†…å®¹ï¼Œå¹¶åˆ é™¤ <code class="language-plaintext highlighter-rouge">continue</code> è¯­å¥å¯¹åº”çš„èŠ‚ç‚¹ï¼›</li>
  <li>éå†å®Œæˆåï¼Œå°†ç¬¬ä¸‰æ­¥çš„æ•°ç»„æ›¿æ¢æ‰æ•´ä¸ª while èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ <code class="language-plaintext highlighter-rouge">WhileStatement</code>ã€‚</li>
</ol>

<p>ä¸åŒæ€è·¯ï¼Œå†™æ³•å¤šæ ·ï¼Œå¯¹äºå¦‚ä½•è·å–æ§åˆ¶æµæ•°ç»„ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹æ€è·¯ï¼š</p>

<ol>
  <li>è·å–åˆ° <code class="language-plaintext highlighter-rouge">While</code> è¯­å¥èŠ‚ç‚¹ï¼Œç„¶åä½¿ç”¨ <code class="language-plaintext highlighter-rouge">path.getAllPrevSiblings()</code> æ–¹æ³•è·å–å…¶å‰é¢çš„æ‰€æœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œéå†æ¯ä¸ªå…„å¼ŸèŠ‚ç‚¹ï¼Œæ‰¾åˆ°ä¸ <code class="language-plaintext highlighter-rouge">switch()</code> é‡Œé¢æ•°ç»„çš„å˜é‡åç›¸åŒçš„èŠ‚ç‚¹ï¼Œç„¶åå†å–èŠ‚ç‚¹çš„å€¼è¿›è¡Œåç»­å¤„ç†ï¼›</li>
  <li>ç›´æ¥å– <code class="language-plaintext highlighter-rouge">switch()</code> é‡Œé¢æ•°ç»„çš„å˜é‡åï¼Œç„¶åä½¿ç”¨ <code class="language-plaintext highlighter-rouge">scope.getBinding()</code> æ–¹æ³•è·å–åˆ°å®ƒç»‘å®šçš„èŠ‚ç‚¹ï¼Œç„¶åå†å–è¿™ä¸ªèŠ‚ç‚¹çš„å€¼è¿›è¡Œåç»­å¤„ç†ã€‚</li>
</ol>

<p>æ‰€ä»¥ AST å¤„ç†ä»£ç å°±æœ‰ä¸¤ç§å†™æ³•ï¼Œæ–¹æ³•ä¸€ï¼šï¼ˆcode.js å³ä¸ºå‰é¢çš„ç¤ºä¾‹ä»£ç ï¼Œä¸ºäº†æ–¹ä¾¿æ“ä½œï¼Œè¿™é‡Œä½¿ç”¨ fs ä»æ–‡ä»¶ä¸­è¯»å–ä»£ç ï¼‰</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/generator</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">traverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/traverse</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/types</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">"</span><span class="s2">code.js</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">encoding</span><span class="p">:</span> <span class="dl">"</span><span class="s2">utf-8</span><span class="dl">"</span><span class="p">});</span>
<span class="kd">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">WhileStatement</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// switch èŠ‚ç‚¹</span>
        <span class="kd">let</span> <span class="nx">switchNode</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="c1">// switch è¯­å¥å†…çš„æ§åˆ¶æµæ•°ç»„åï¼Œæœ¬ä¾‹ä¸­æ˜¯ _0x34e16a</span>
        <span class="kd">let</span> <span class="nx">arrayName</span> <span class="o">=</span> <span class="nx">switchNode</span><span class="p">.</span><span class="nx">discriminant</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="c1">// è·å¾—æ‰€æœ‰ while å‰é¢çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œæœ¬ä¾‹ä¸­è·å–åˆ°çš„æ˜¯å£°æ˜ä¸¤ä¸ªå˜é‡çš„èŠ‚ç‚¹ï¼Œå³ const _0x34e16a å’Œ let _0x2eff02</span>
        <span class="kd">let</span> <span class="nx">prevSiblings</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">getAllPrevSiblings</span><span class="p">();</span>
        <span class="c1">// å®šä¹‰ç¼“å­˜æ§åˆ¶æµæ•°ç»„</span>
        <span class="kd">let</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">// forEach æ–¹æ³•éå†æ‰€æœ‰èŠ‚ç‚¹</span>
        <span class="nx">prevSiblings</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">pervNode</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="p">{</span><span class="nx">id</span><span class="p">,</span> <span class="nx">init</span><span class="p">}</span> <span class="o">=</span> <span class="nx">pervNode</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">declarations</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="c1">// å¦‚æœèŠ‚ç‚¹ id.name ä¸ switch è¯­å¥å†…çš„æ§åˆ¶æµæ•°ç»„åç›¸åŒ</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">arrayName</span> <span class="o">===</span> <span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// è·å–èŠ‚ç‚¹æ•´ä¸ªè¡¨è¾¾å¼çš„å‚æ•°ã€åˆ†å‰²æ–¹æ³•ã€åˆ†éš”ç¬¦</span>
                <span class="kd">let</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">init</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
                <span class="kd">let</span> <span class="nx">property</span> <span class="o">=</span> <span class="nx">init</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
                <span class="kd">let</span> <span class="nx">argument</span> <span class="o">=</span> <span class="nx">init</span><span class="p">.</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
                <span class="c1">// æ¨¡æ‹Ÿæ‰§è¡Œ '3,4,0,5,1,2'['split'](',') è¯­å¥</span>
                <span class="nx">array</span> <span class="o">=</span> <span class="nx">object</span><span class="p">[</span><span class="nx">property</span><span class="p">](</span><span class="nx">argument</span><span class="p">)</span>
                <span class="c1">// ä¹Ÿå¯ä»¥ç›´æ¥å–å‚æ•°è¿›è¡Œåˆ†å‰²ï¼Œæ–¹æ³•ä¸é€šç”¨ï¼Œæ¯”å¦‚åˆ†éš”ç¬¦æ¢æˆ | å°±ä¸è¡Œäº†</span>
                <span class="c1">// array = init.callee.object.value.split(',');</span>
            <span class="p">}</span>
            <span class="c1">// å‰é¢çš„å…„å¼ŸèŠ‚ç‚¹å°±å¯ä»¥åˆ é™¤äº†</span>
            <span class="nx">pervNode</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
        <span class="p">});</span>

        <span class="c1">// å‚¨å­˜æ­£ç¡®é¡ºåºçš„æ§åˆ¶æµè¯­å¥</span>
        <span class="kd">let</span> <span class="nx">replace</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="c1">// éå†æ§åˆ¶æµæ•°ç»„ï¼ŒæŒ‰æ­£ç¡®é¡ºåºå– case å†…å®¹</span>
        <span class="nx">array</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">index</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">consequent</span> <span class="o">=</span> <span class="nx">switchNode</span><span class="p">.</span><span class="nx">cases</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">consequent</span><span class="p">;</span>
                <span class="c1">// å¦‚æœæœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯ continue è¯­å¥ï¼Œåˆ™åˆ é™¤ ContinueStatement èŠ‚ç‚¹</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">isContinueStatement</span><span class="p">(</span><span class="nx">consequent</span><span class="p">[</span><span class="nx">consequent</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nx">consequent</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="c1">// concat æ–¹æ³•æ‹¼æ¥å¤šä¸ªæ•°ç»„ï¼Œå³æ­£ç¡®é¡ºåºçš„ case å†…å®¹</span>
                <span class="nx">replace</span> <span class="o">=</span> <span class="nx">replace</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">consequent</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">);</span>
        <span class="c1">// æ›¿æ¢æ•´ä¸ª while èŠ‚ç‚¹ï¼Œä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">replace</span><span class="p">);</span>
        <span class="c1">// path.replaceInline(replace);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="nx">visitor</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span>
</code></pre></div></div>

<p>æ–¹æ³•äºŒï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">generate</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/generator</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">traverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/traverse</span><span class="dl">"</span><span class="p">).</span><span class="k">default</span>
<span class="kd">const</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">@babel/types</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">"</span><span class="s2">code.js</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">encoding</span><span class="p">:</span> <span class="dl">"</span><span class="s2">utf-8</span><span class="dl">"</span><span class="p">});</span>
<span class="kd">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">WhileStatement</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// switch èŠ‚ç‚¹</span>
        <span class="kd">let</span> <span class="nx">switchNode</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="c1">// switch è¯­å¥å†…çš„æ§åˆ¶æµæ•°ç»„åï¼Œæœ¬ä¾‹ä¸­æ˜¯ _0x34e16a</span>
        <span class="kd">let</span> <span class="nx">arrayName</span> <span class="o">=</span> <span class="nx">switchNode</span><span class="p">.</span><span class="nx">discriminant</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="c1">// è·å–æ§åˆ¶æµæ•°ç»„ç»‘å®šçš„èŠ‚ç‚¹</span>
        <span class="kd">let</span> <span class="nx">bindingArray</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">getBinding</span><span class="p">(</span><span class="nx">arrayName</span><span class="p">);</span>
        <span class="c1">// è·å–èŠ‚ç‚¹æ•´ä¸ªè¡¨è¾¾å¼çš„å‚æ•°ã€åˆ†å‰²æ–¹æ³•ã€åˆ†éš”ç¬¦</span>
        <span class="kd">let</span> <span class="nx">init</span> <span class="o">=</span> <span class="nx">bindingArray</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">init</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">init</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">property</span> <span class="o">=</span> <span class="nx">init</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">argument</span> <span class="o">=</span> <span class="nx">init</span><span class="p">.</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
        <span class="c1">// æ¨¡æ‹Ÿæ‰§è¡Œ '3,4,0,5,1,2'['split'](',') è¯­å¥</span>
        <span class="kd">let</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">object</span><span class="p">[</span><span class="nx">property</span><span class="p">](</span><span class="nx">argument</span><span class="p">)</span>
        <span class="c1">// ä¹Ÿå¯ä»¥ç›´æ¥å–å‚æ•°è¿›è¡Œåˆ†å‰²ï¼Œæ–¹æ³•ä¸é€šç”¨ï¼Œæ¯”å¦‚åˆ†éš”ç¬¦æ¢æˆ | å°±ä¸è¡Œäº†</span>
        <span class="c1">// let array = init.callee.object.value.split(',');</span>

        <span class="c1">// switch è¯­å¥å†…çš„æ§åˆ¶æµè‡ªå¢å˜é‡åï¼Œæœ¬ä¾‹ä¸­æ˜¯ _0x2eff02</span>
        <span class="kd">let</span> <span class="nx">autoIncrementName</span> <span class="o">=</span> <span class="nx">switchNode</span><span class="p">.</span><span class="nx">discriminant</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">argument</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="c1">// è·å–æ§åˆ¶æµè‡ªå¢å˜é‡åç»‘å®šçš„èŠ‚ç‚¹</span>
        <span class="kd">let</span> <span class="nx">bindingAutoIncrement</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">getBinding</span><span class="p">(</span><span class="nx">autoIncrementName</span><span class="p">);</span>
        <span class="c1">// å¯é€‰æ‹©çš„æ“ä½œï¼šåˆ é™¤æ§åˆ¶æµæ•°ç»„ç»‘å®šçš„èŠ‚ç‚¹ã€è‡ªå¢å˜é‡åç»‘å®šçš„èŠ‚ç‚¹</span>
        <span class="nx">bindingArray</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
        <span class="nx">bindingAutoIncrement</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>

        <span class="c1">// å‚¨å­˜æ­£ç¡®é¡ºåºçš„æ§åˆ¶æµè¯­å¥</span>
        <span class="kd">let</span> <span class="nx">replace</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="c1">// éå†æ§åˆ¶æµæ•°ç»„ï¼ŒæŒ‰æ­£ç¡®é¡ºåºå– case å†…å®¹</span>
        <span class="nx">array</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">index</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">consequent</span> <span class="o">=</span> <span class="nx">switchNode</span><span class="p">.</span><span class="nx">cases</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">consequent</span><span class="p">;</span>
                <span class="c1">// å¦‚æœæœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯ continue è¯­å¥ï¼Œåˆ™åˆ é™¤ ContinueStatement èŠ‚ç‚¹</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">isContinueStatement</span><span class="p">(</span><span class="nx">consequent</span><span class="p">[</span><span class="nx">consequent</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nx">consequent</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="c1">// concat æ–¹æ³•æ‹¼æ¥å¤šä¸ªæ•°ç»„ï¼Œå³æ­£ç¡®é¡ºåºçš„ case å†…å®¹</span>
                <span class="nx">replace</span> <span class="o">=</span> <span class="nx">replace</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">consequent</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">);</span>
        <span class="c1">// æ›¿æ¢æ•´ä¸ª while èŠ‚ç‚¹ï¼Œä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">replace</span><span class="p">);</span>
        <span class="c1">// path.replaceInline(replace);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="nx">visitor</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span>
</code></pre></div></div>

<p>ä»¥ä¸Šä»£ç è¿è¡Œåï¼ŒåŸæ¥çš„ <code class="language-plaintext highlighter-rouge">switch-case</code> æ§åˆ¶æµå°±è¢«è¿˜åŸäº†ï¼Œå˜æˆäº†æŒ‰é¡ºåºä¸€è¡Œä¸€è¡Œçš„ä»£ç ï¼Œæ›´åŠ ç®€æ´æ˜äº†ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">_0x4588f1</span> <span class="o">=</span> <span class="mh">0x1</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">_0x470e97</span> <span class="o">=</span> <span class="mh">0x2</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">_0x38cb15</span> <span class="o">=</span> <span class="nx">_0x4588f1</span> <span class="o">+</span> <span class="nx">_0x470e97</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">_0x37b9f3</span> <span class="o">=</span> <span class="mh">0x5</span> <span class="o">||</span> <span class="nx">_0x38cb15</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">_0x1e0e5e</span> <span class="o">=</span> <span class="nx">_0x37b9f3</span><span class="p">[</span><span class="nx">_0x50cee0</span><span class="p">(</span><span class="mh">0x2e0</span><span class="p">,</span> <span class="mh">0x2e8</span><span class="p">,</span> <span class="mh">0x2e1</span><span class="p">,</span> <span class="mh">0x2e4</span><span class="p">)];</span>
<span class="kd">let</span> <span class="nx">_0x35d732</span> <span class="o">=</span> <span class="p">[</span><span class="nx">_0x388d4b</span><span class="p">(</span><span class="o">-</span><span class="mh">0x134</span><span class="p">,</span> <span class="o">-</span><span class="mh">0x134</span><span class="p">,</span> <span class="o">-</span><span class="mh">0x139</span><span class="p">,</span> <span class="o">-</span><span class="mh">0x138</span><span class="p">)](</span><span class="nx">_0x38cb15</span> <span class="o">&gt;&gt;</span> <span class="nx">_0x4588f1</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>

<p>æœ¬æ–‡æœ‰å‚è€ƒä»¥ä¸‹èµ„æ–™ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒæ¨èçš„åœ¨çº¿å­¦ä¹ èµ„æ–™ï¼š</p>

<ul>
  <li>Youtube è§†é¢‘ï¼ŒBabel å…¥é—¨ï¼š<a href="https://www.youtube.com/watch?v=UeVq_U5obnE">https://www.youtube.com/watch?v=UeVq_U5obnE</a></li>
  <li>å®˜æ–¹æ‰‹å†Œ Babel Handbookï¼š<a href="https://github.com/jamiebuilds/babel-handbook">https://github.com/jamiebuilds/babel-handbook</a></li>
  <li>éå®˜æ–¹ Babel API ä¸­æ–‡æ–‡æ¡£ï¼š<a href="https://evilrecluse.top/Babel-traverse-api-doc/">https://evilrecluse.top/Babel-traverse-api-doc/</a></li>
</ul>

<h2 id="end">END</h2>

<p>Babel ç¼–è¯‘å™¨å›½å†…çš„èµ„æ–™å…¶å®ä¸æ˜¯å¾ˆå¤šï¼Œå¤šçœ‹æºç ã€åŒæ—¶åœ¨çº¿å¯¹ç…§å¯è§†åŒ–çš„ AST è¯­æ³•æ ‘ï¼Œè€å¿ƒä¸€ç‚¹å„¿ä¸€å±‚ä¸€å±‚åˆ†æå³å¯ï¼Œæœ¬æ–‡ä¸­çš„æ¡ˆä¾‹ä¹Ÿåªæ˜¯æœ€åŸºæœ¬æ“ä½œï¼Œå®é™…é‡åˆ°ä¸€äº›æ··æ·†è¿˜å¾—è§†æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚éœ€è¦åŠ ä¸€äº›ç±»å‹åˆ¤æ–­æ¥é™åˆ¶ç­‰ï¼Œåç»­ä¼šç”¨å®æˆ˜æ¥å¸¦é¢†å¤§å®¶è¿›ä¸€æ­¥ç†Ÿæ‚‰è§£æ··æ·†å½“ä¸­çš„å…¶ä»–æ“ä½œã€‚</p>

          </div>
        </div>
      </section>
      <section class="section-register">
        <div class="section-wrapper">
          <h1>æ”»é˜²çª¥è§æ·±æ¸Šï¼Œä¸‡ç‰©è—äºä¸€ç²Ÿ<br/>æ¢ç´¢æŠ€æœ¯è¾¹ç•Œï¼ŒæŒ–æ˜æ•°æ®ä»·å€¼</h1>
          <p>WuKong Securityä¸¨æ‚Ÿç©ºä¿¡æ¯å®‰å…¨</p>
          <div class="code-and-button">
            <a
              href="/docs/usage/quick-start/"
              title="Register Now"
              class="button big accent-border border-corners inner-shadows"
            >
              è”ç³»æˆ‘ä»¬ Contact
            </a>
          </div>
        </div>
      </section>
    </main>
    <footer>
  <div class="section-background">
    <div class="section-wrapper">
      <div class="hexagon hexagon-10"></div>
      <div class="hexagon hexagon-11"></div>
    </div>
  </div>
  <div class="section-wrapper">
    <nav class="main-nav">
      <a href="https://wukongsec.com" title="Go to home page" class="logo-link">
        <img alt="PM2 logo" src="https://wukongsec.com/assets/img/logo/logo_wk_004.png" />
      </a>
      <div class="doc-links">
        <a href="http://bbs.wukongsec.com/" target="_blank">è®ºå› BBS</a>
        <a href="https://wukongsec.com/blog/">åšå®¢ Blog</a>
        <a href="https://wukongsec.com/docs/about/">å…³äº About</a>
      </div>
      <div class="button-border">
        <a href="https://wukongsec.com/contact/" class="button accent-border border-corners big inner-shadows">
          åŠ å…¥æˆ‘ä»¬ Join us
        </a>
      </div>
    </nav>
    <div class="below-nav">
      <div class="copyright">
        Copyright Â© 2023-<script>document.write(new Date().getFullYear().toString());</script> <a href="https://wukongsec.com/" title="WuKong Security â€¢ æ‚Ÿç©ºæ•°æ®å®‰å…¨">WuKong Security</a> All Rights Reserved.
      </div>
      <div>
        <a href="https://beian.miit.gov.cn/" target="_blank"><img src="https://wukongsec.com/assets/img/general/icp_48x48.png" alt="ICP å¤‡æ¡ˆå·" style="width:auto; height:17px; margin-bottom:-4px"> é„‚ICPå¤‡ 19003281å·-10</a>ä¸¨
        <a href="https://beian.mps.gov.cn/" target="_blank"><img src="https://wukongsec.com/assets/img/general/mps_48x48.png" alt="MPS å…¬ç½‘å®‰å¤‡" style="width:auto; height:17px; margin-bottom:-3px"> é„‚å…¬ç½‘å®‰å¤‡ 42280202422959</a>
      </div>
    </div>
  </div>
</footer>

<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id:"3IvKxKuUS0UrDMdL",ck:"3IvKxKuUS0UrDMdL"})</script>

<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?3163eb94091b9129cb5fbf99051644ff";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>


    <script src="https://wukongsec.com/assets/js/testimonials.js"></script>
    <script src="https://wukongsec.com/assets/js/menu.js"></script>
  </body>
</html>
